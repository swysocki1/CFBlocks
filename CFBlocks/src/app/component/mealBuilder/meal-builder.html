<div class="card meal-builder">
  <div class="card-body">
    <div class="row">
      <div class="col">
        <h1>
          <b>{{getFormatedName()}}'s Meals -
            <span class="dropdown-toggle" id="meal-builder-date-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{mealDay | date: 'MMMM d'}}</span>
            <div id="meal-builder-date-dropdown-menu" class="dropdown-menu" aria-labelledby="meal-builder-date-dropdown"></div>
          </b>
        </h1>
      </div>
    </div>
    <div class="row">
      <div class="col meal-container">
        <div class="row meal-totals">
          <div class="col text-center">
            <span class="todays-totals">
              <label class="control-label"><b>Carbs:</b></label><span class="mr-2 ">&nbsp;{{(getTodaysCarbTotal() | number:'1.0-2') + 'g / ' + (getDailyCarbTotal() | number:'1.0-2' ) + 'g'}}</span>
            </span>
            <div class="progress" *ngIf="getDailyCarbTotal()">
              <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" [style.width.%]="getTodaysCarbTotal()/getDailyCarbTotal()"></div>
            </div>
            <span class="todays-totals">
              <label class="control-label"><b>Fats:</b></label><span class="mr-2">&nbsp;{{(getTodaysFatTotal() | number:'1.0-2') + 'g / ' + (getDailyFatTotal() | number:'1.0-2') + 'g'}}</span>
            </span>
            <div class="progress" *ngIf="getDailyCarbTotal()">
              <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" [style.width.%]="getTodaysFatTotal()/getDailyFatTotal()"></div>
            </div>
            <span class="todays-totals">
              <label class="control-label"><b>Protein:</b></label><span class="mr-2">&nbsp;{{(getTodaysProteinTotal() | number:'1.0-2') + 'g / ' + (getDailyProteinTotal() | number:'1.0-2') + 'g'}}</span>
            </span>
            <div class="progress" *ngIf="getDailyCarbTotal()">
              <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" [style.width.%]="getTodaysProteinTotal()/getDailyProteinTotal()"></div>
            </div>
            <span class="todays-totals">
              <label class="control-label"><b>Calories:</b></label><span class="mr-2">&nbsp;{{(getTodaysCalorieTotal() | number:'1.0-2') + 'kcals / ' + (getDailyCalorieTotal() | number:'1.0-2') + 'kcals'}}</span>
            </span>
            <div class="progress" *ngIf="getDailyCarbTotal()">
              <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" [style.width.%]="getTodaysCalorieTotal()/getDailyCalorieTotal()"></div>
            </div>
          </div>
        </div>
        <div class="row meals">
          <div class="col">
            <meal-editor [meals]="mealCalendar.meals" (loadMealModal)="loadSelectFoodModule()" (saveMeals)="updateAndSaveMeals($event)"></meal-editor>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal scroll fade" id="food-selector-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Select Foods in the Meal</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="fa fa-fw fa-times coal"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="row food-container">
          <div class="col-1">
            <div class="form-group">
              <label class="control-label">Name: </label>
            </div>
          </div>
          <div class="col-5">
            <div class="form-group">
              <input class="form-control form-control-sm" [ngClass]="{'is-invalid': !meal.name}" type="text" [(ngModel)]="meal.name"/>
              <div class="invalid-feedback">Must have Name of Meal</div>
            </div>
          </div>
          <div class="col-5">
            <div class="form-group">
              <input type="search" class="form-control form-control-sm" [ngClass]="{'is-invalid': (foods | foodFilter:search:meal?.foods:user?.favFoods).length < 1}" id="food-filter" [(ngModel)]="search" placeholder="Filter"/>
              <div class="invalid-feedback">No Results Were Found</div>
            </div>
          </div>
          <div class="col-1">
            <span class="rounded-circle coal grey1-fill grey3-fill-hover pull-left create-food pointer" title="Create New Food" (click)="loadFoodModal()"><i class="fa fa-lg fa-fw fa-plus"></i></span>
          </div>
        </div>
        <div class="row">
          <div class="col-6" *ngFor="let food of foods | foodFilter:search:meal?.foods:user?.favFoods" style="padding:5px;">
            <!--<food-item *ngFor="let food of foods | foodFilter : {search: search, alreadyUsed: meal.foods}" [food]="food"  (updateFood)="loadFoodModal(food)"></food-item>-->
            <food-item [food]="food" [isSelected]="inMeal(food)" [canAdd]="!inMeal(food)" [canUpdate]="true" [canRemove]="inMeal(food)" (updateFood)="loadFoodModal(food)" (add)="addFoodToMeal($event)" (remove)="removeFoodFromMeal($event)"></food-item>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="row">
          <div class="col text-center">
            <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Cancel">Cancel</button>
            <button type="submit" class="btn btn-primary" style="margin-left: 15px;" [disabled]="!canUpdateMeal()" (click)="updateMeal()">Create Meal</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modify-food-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <food-creator [food]="updateFood" (cancelEvent)="resetFoodCreator()"></food-creator>
    </div>
  </div>
</div>
